function z(){}var B=document?.createElement?.bind(document)??z,N=globalThis?.setTimeout??z,X=globalThis?.alert??z,P=console?.log?.bind(console)??z,J=console?.warn?.bind(console)??z,K=console?.error?.bind(console)??z,q={last_heartbeat:Date.now(),heartbeat_interval_ms:null,watchdog_timeout_ms:null,watchdog_beat_misses:0,timeout_id:null},F={WARN:2,ALERT:10,DIALOG:30};function Y(k,j){q.last_heartbeat=Date.now(),q.heartbeat_interval_ms=k,q.watchdog_timeout_ms=j,N(Q,j),P(`Watchdog initialized with interval: ${k} ms, timeout: ${j} ms`)}function Z(){q.last_heartbeat=Date.now()}function Q(){q.timeout_id=null;let k=q.last_heartbeat,j=Date.now(),x=q.watchdog_timeout_ms;if(x==null)return;if(k+x<j)++q.watchdog_beat_misses,U(q.watchdog_beat_misses,x);else{if(q.watchdog_beat_misses>=F.WARN)P(`Heartbeat restored after ${q.watchdog_beat_misses*x} ms`);q.watchdog_beat_misses=0}let y=N(Q,x);q.timeout_id=y}function U(k,j){if(k==F.WARN)J(`No heartbeats in over ${k*j} ms. Is the WASM engine busy?`);else if(k==F.ALERT)J(`The WASM engine seems unresponsive (no heartbeats in ${k*j} ms).`);else if(k==F.DIALOG){K(`No heartbeats from WASM engine after ${k*j} ms. Displaying frozen message.`);try{V(k*j)}catch(x){K(`Error trying to display panic message: ${x}`)}}}function V(k){let j=B("dialog");if(j.setAttribute("open",""),typeof j=="undefined"||j==null)throw new Error("Could not create dialog element");document?.body?.appendChild(j);try{let y=B("h1");y.textContent="Frozen!",j.appendChild(y)}catch{}let x=B("p");x.textContent=`No heartbeats from WASM engine after ${k} ms. Check the console for any possible errors.`,j.appendChild(x);try{let y=B("button");y.textContent="Dismiss",y.setAttribute("onclick","this.parentElement.close()"),j.appendChild(y)}catch{}}export{Y as init_watchdog,Z as heartbeat};
