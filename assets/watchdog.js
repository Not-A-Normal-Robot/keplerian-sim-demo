function B(){}var F=document?.createElement?.bind(document)??B,P=globalThis?.setTimeout??B,V=console?.debug?.bind(console)??B,Q=console?.log?.bind(console)??B,K=console?.warn?.bind(console)??B,N=console?.error?.bind(console)??B,k={last_heartbeat:Date.now(),heartbeat_interval_ms:null,watchdog_timeout_ms:null,watchdog_beat_misses:0,timeout_id:null,tabbed_out:!1},J={WARN:2,ALERT:10,DIALOG:30};function X(q,j){k.last_heartbeat=Date.now(),k.heartbeat_interval_ms=q,k.watchdog_timeout_ms=j,P(U,j),Q(`Watchdog initialized with interval: ${q} ms, timeout: ${j} ms`)}function Y(){k.last_heartbeat=Date.now(),V(`Heartbeat: ${Date.now()}`)}globalThis.init_watchdog=X;globalThis.heartbeat=Y;function U(){k.timeout_id=null;let q=k.last_heartbeat,j=Date.now(),x=k.watchdog_timeout_ms;if(x==null)return;if(q+x<j&&!k.tabbed_out)++k.watchdog_beat_misses,Z(k.watchdog_beat_misses,x);else{if(k.watchdog_beat_misses>=J.WARN)Q(`Heartbeat restored after ${k.watchdog_beat_misses*x} ms`);k.watchdog_beat_misses=0}let z=P(U,x);k.timeout_id=z}function Z(q,j){if(q==J.WARN)K(`No heartbeats in over ${q*j} ms. Is the WASM engine busy?`);else if(q==J.ALERT)K(`The WASM engine seems unresponsive (no heartbeats in ${q*j} ms).`);else if(q==J.DIALOG){N(`No heartbeats from WASM engine after ${q*j} ms. Displaying frozen message.`);try{$(q*j)}catch(x){N(`Error trying to display panic message: ${x}`)}}}function $(q){let j=F("dialog");if(j.setAttribute("open",""),typeof j=="undefined"||j==null)throw new Error("Could not create dialog element");document?.body?.appendChild(j);try{let z=F("h1");z.textContent="Frozen!",j.appendChild(z)}catch{}let x=F("p");x.textContent=`No heartbeats from WASM engine after ${q} ms. Check the console for any possible errors.`,j.appendChild(x);try{let z=F("button");z.textContent="Dismiss",z.setAttribute("onclick","this.parentElement.close()"),j.appendChild(z)}catch{}}function f(){if(document?.visibilityState==="hidden")k.tabbed_out=!0;else if(document?.visibilityState==="visible")k.tabbed_out=!1}document?.addEventListener("visibilitychange",f);
